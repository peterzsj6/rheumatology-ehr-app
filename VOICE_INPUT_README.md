# 语音输入功能说明

## 功能概述

风湿免疫科电子病历生成系统现已支持语音输入功能，用户可以通过语音录制问诊记录，然后转换为文字输入到系统中。

## 功能特点

### 1. 实时录音
- 支持浏览器内直接录音
- 实时显示录音状态和时间
- 录音完成后可下载音频文件

### 2. 音频文件上传
- 支持WAV、MP3格式音频文件
- 支持多种语音识别服务
- 支持多语言识别

### 3. 语音识别服务
- **Google Speech Recognition**：免费，支持多种语言
- **Azure Speech Services**：高精度，需要API密钥
- **百度语音识别**：中文识别效果好，需要API密钥
- **腾讯语音识别**：中文识别效果好，需要API密钥

## 使用方法

### 方法1：浏览器录音
1. 点击"🎤 开始录音"按钮
2. 允许浏览器访问麦克风
3. 开始说话，录制问诊记录
4. 点击"⏹️ 停止录音"按钮
5. 下载录音文件
6. 上传录音文件进行转换

### 方法2：上传音频文件
1. 准备音频文件（WAV或MP3格式）
2. 点击"上传音频文件"按钮
3. 选择音频文件
4. 选择语音识别服务和语言
5. 点击"🎵 转换语音为文字"
6. 查看转换结果并编辑

## 语音识别服务配置

### Google Speech Recognition（推荐）
- **优点**：免费，支持多种语言，无需API密钥
- **缺点**：需要网络连接，识别精度一般
- **适用场景**：测试和简单使用

### Azure Speech Services
- **优点**：识别精度高，支持多种语言
- **缺点**：需要API密钥，收费
- **配置方法**：
  1. 注册Azure账号
  2. 创建Speech Services资源
  3. 获取API密钥和区域信息
  4. 在代码中配置

### 百度语音识别
- **优点**：中文识别效果好，价格便宜
- **缺点**：主要支持中文
- **配置方法**：
  1. 注册百度AI开放平台
  2. 创建语音应用
  3. 获取API Key和Secret Key
  4. 在代码中配置

### 腾讯语音识别
- **优点**：中文识别效果好，支持多种方言
- **缺点**：主要支持中文
- **配置方法**：
  1. 注册腾讯云账号
  2. 开通语音识别服务
  3. 获取SecretId和SecretKey
  4. 在代码中配置

## 技术实现

### 前端组件
- 使用HTML5 MediaRecorder API进行录音
- JavaScript处理录音逻辑
- Streamlit组件集成

### 后端服务
- Python speech_recognition库
- 支持多种语音识别API
- 临时文件管理

### 文件格式支持
- **输入格式**：WAV、MP3
- **输出格式**：文本
- **采样率**：44.1kHz（推荐）
- **声道**：单声道（推荐）

## 注意事项

1. **浏览器兼容性**：需要支持MediaRecorder API的现代浏览器
2. **网络连接**：语音识别需要网络连接
3. **音频质量**：清晰的音频有助于提高识别准确率
4. **语言选择**：选择正确的语言可以提高识别准确率
5. **隐私保护**：录音文件仅在本地处理，不会上传到第三方服务器

## 故障排除

### 常见问题

1. **无法录音**
   - 检查浏览器是否允许麦克风访问
   - 检查麦克风设备是否正常工作
   - 尝试刷新页面

2. **识别结果不准确**
   - 检查音频质量是否清晰
   - 确认选择了正确的语言
   - 尝试使用不同的语音识别服务

3. **转换失败**
   - 检查网络连接
   - 确认音频文件格式正确
   - 检查API密钥配置（如果使用付费服务）

### 调试信息
- 查看浏览器控制台错误信息
- 检查Streamlit日志输出
- 确认依赖包安装正确

## 未来改进

1. **实时语音识别**：支持边说话边识别
2. **多语言支持**：支持更多语言和方言
3. **自定义词汇**：支持医疗专业词汇识别
4. **离线识别**：支持本地语音识别
5. **语音合成**：支持将生成的病历转换为语音

## 依赖包

```bash
pip install SpeechRecognition>=3.10.0
pip install pyaudio>=0.2.11
pip install requests>=2.28.0
```

## 配置示例

```python
# 使用Google Speech Recognition
speech_service = create_speech_recognition_service(service_type="google")

# 使用Azure Speech Services
speech_service = create_speech_recognition_service(
    api_key="your_azure_api_key",
    service_type="azure"
)

# 转换音频文件
result = speech_service.transcribe_audio_file("audio.wav", language="zh-CN")
``` 