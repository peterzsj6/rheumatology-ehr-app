# 语音输入功能使用指南

## 概述

风湿免疫科电子病历生成系统现在支持多种语音输入模式，让您可以通过语音快速输入问诊记录，然后自动转换为文字。

## 语音输入模式

### 1. 基础模式
- **特点**: 最简单的录音功能
- **适用**: 初次使用或简单录音需求
- **流程**: 录音 → 下载 → 上传 → 转换

### 2. 简化模式（推荐）
- **特点**: 最稳定的录音和转换功能
- **适用**: 日常使用，稳定性要求高
- **流程**: 录音 → 下载 → 上传 → 转换
- **优势**: 兼容性好，转换成功率高

### 3. 自动模式
- **特点**: 自动下载录音文件
- **适用**: 希望减少手动操作的场景
- **流程**: 录音 → 自动下载 → 上传 → 转换
- **优势**: 操作便捷，用户体验好

### 4. 增强模式
- **特点**: 功能最全面，支持多种音频格式
- **适用**: 高级用户，需要更多功能
- **流程**: 录音 → 自动转换（可能不稳定）
- **注意**: 可能存在转换卡住的问题

## 使用步骤

### 推荐流程（简化模式）

1. **启动应用**
   ```bash
   streamlit run rheumatology_ehr_app.py
   ```

2. **选择语音输入模式**
   - 在侧边栏选择"简化模式（推荐）"

3. **开始录音**
   - 点击"🎤 开始录音"按钮
   - 允许浏览器访问麦克风
   - 开始说话（建议清晰、语速适中）

4. **停止录音**
   - 点击"⏹️ 停止录音"按钮
   - 录音完成后会显示播放器和下载按钮

5. **下载录音文件**
   - 点击"📥 下载录音"按钮
   - 文件会自动下载到您的下载文件夹

6. **上传并转换**
   - 在"上传录音文件"区域选择下载的录音文件
   - 选择语音识别服务（推荐Google）
   - 选择语言（中文简体）
   - 点击"🎵 转换语音为文字"

7. **使用转换结果**
   - 转换完成后，文字会自动填入问诊记录输入框
   - 可以编辑文字内容
   - 点击"🚀 生成电子病历"生成病历

8. **导出和保存**
   - 点击"📄 导出为Word"生成Word文档
   - 点击"📥 下载Word文档"保存文件
   - 或点击"📋 复制到剪贴板"复制文本内容

## 故障排除

### 问题1: 语音转换卡住
**症状**: 转换过程一直显示"正在转换语音..."
**解决方案**:
1. 使用"简化模式"而不是"增强模式"
2. 确保录音文件格式正确（WebM、MP3、WAV）
3. 检查网络连接
4. 尝试重新录音

### 问题2: 无法访问麦克风
**症状**: 点击录音按钮后提示无法访问麦克风
**解决方案**:
1. 确保浏览器允许麦克风访问权限
2. 检查系统麦克风设置
3. 尝试刷新页面
4. 使用不同的浏览器

### 问题3: 转换失败
**症状**: 转换后显示错误信息
**解决方案**:
1. 检查录音质量（避免背景噪音）
2. 尝试使用不同的语音识别服务
3. 确保录音时长适中（5-60秒）
4. 系统会自动提供示例文字作为备选

### 问题4: Google Speech Recognition格式错误
**症状**: 显示"Audio file could not be read as PCM WAV"错误
**解决方案**:
1. **使用音频修复功能**: 系统现在会自动修复音频格式
2. **重新录音**: 使用浏览器原生录音功能，选择WebM格式
3. **检查ffmpeg**: 确保系统安装了ffmpeg（用于音频转换）
4. **尝试不同格式**: 如果WebM失败，尝试MP3或WAV格式
5. **使用简化模式**: 选择"简化模式（推荐）"进行录音

### 问题5: 音频格式不支持
**症状**: 上传音频文件后无法播放或转换
**解决方案**:
1. 确保音频格式为WAV、MP3、WebM、OGG
2. 使用系统自带的录音功能
3. 检查音频文件是否损坏

## 最佳实践

### 录音技巧
1. **环境安静**: 选择安静的环境进行录音
2. **距离适中**: 保持与麦克风15-30厘米的距离
3. **语速适中**: 说话速度不要太快，确保清晰
4. **内容完整**: 一次性说完完整的问诊内容
5. **避免重复**: 避免重复录音，影响质量

### 转换优化
1. **服务选择**: 优先使用Google Speech Recognition
2. **语言设置**: 确保选择正确的语言（中文简体）
3. **文件大小**: 录音文件不要太大（建议<10MB）
4. **格式选择**: 优先使用WebM格式录音

### 内容建议
1. **结构化描述**: 按照病历格式描述症状
2. **时间信息**: 包含症状出现的时间
3. **症状细节**: 详细描述症状特点
4. **既往史**: 包含相关病史信息
5. **用药情况**: 说明当前用药情况

## 导出功能

### Word文档导出
- **格式**: .docx (Microsoft Word格式)
- **内容**: 完整的电子病历结构
- **功能**: 
  - 自动生成标准病历格式
  - 包含生成时间和签名区域
  - 支持直接下载保存
  - 文件名自动包含时间戳

### 复制到剪贴板
- **格式**: 纯文本格式
- **内容**: 结构化的病历文本
- **功能**: 
  - 一键复制所有病历内容
  - 支持粘贴到其他应用程序
  - 包含生成时间信息

## 技术说明

### 支持的音频格式
- **WebM**: 浏览器原生支持，推荐使用
- **MP3**: 广泛支持，兼容性好
- **WAV**: 无损格式，文件较大
- **OGG**: 开源格式，压缩率高

### 语音识别服务
- **Google Speech Recognition**: 免费，准确率高，推荐使用
- **Azure Speech Services**: 付费服务，功能强大
- **百度语音识别**: 中文识别效果好
- **腾讯语音识别**: 中文识别效果好

### 系统要求
- **浏览器**: Chrome、Firefox、Safari、Edge
- **网络**: 稳定的互联网连接
- **麦克风**: 内置或外接麦克风
- **权限**: 浏览器麦克风访问权限

## 更新日志

### v2.1.0 (当前版本)
- ✅ 新增Word文档导出功能
- ✅ 实现复制到剪贴板功能
- ✅ 新增4种语音输入模式
- ✅ 支持多种音频格式
- ✅ 集成多种语音识别服务
- ✅ 优化用户界面和体验
- ✅ 添加故障排除功能
- ✅ 提供示例文字备选方案

### 计划功能
- 🔄 实时语音转文字
- 🔄 多语言支持
- 🔄 语音命令控制
- 🔄 批量音频处理
- 🔄 云端音频存储

## 联系支持

如果您在使用过程中遇到问题，请：
1. 查看故障排除部分
2. 尝试不同的语音输入模式
3. 检查系统要求和网络连接
4. 联系技术支持团队

---

**注意**: 语音输入功能需要网络连接和浏览器支持。建议在稳定的网络环境下使用，并确保浏览器已更新到最新版本。 